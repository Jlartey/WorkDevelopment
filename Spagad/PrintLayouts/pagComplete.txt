'<<--BEGIN_CODE_SEGMENT_PRINTHEADER-->>

response.Clear
conn.commandTimeOut = 7200
'Dim periodStart, periodEnd, brnchID
'Dim page_title
'page_title = ""

Dim periodStart, periodEnd, datePeriod, selectedWardIDs, idsArr, formattedIDs, id, dateArr

' Retrieve query parameters
    datePeriod = Trim(request.querystring("Dateperiod"))
    selectedWardIDs = Trim(request.querystring("WardID"))
    
    ' Parse date period
    If datePeriod <> "" Then
        dateArr = Split(datePeriod, "||")
        periodStart = dateArr(0)
        periodEnd = dateArr(1)
    End If
    
     ' Format selected drug store IDs
    If selectedWardIDs <> "" Then
        idsArr = Split(selectedWardIDs, ",")
        For Each id In idsArr
            formattedIDs = formattedIDs & "'" & Trim(id) & "',"
        Next
        ' Remove the trailing comma
        formattedIDs = Left(formattedIDs, Len(formattedIDs) - 1)
    End If

'If Len(Trim(request.querystring("selectedValue"))) > 1 Then
'    periodStart = Trim(request.querystring("selectedValue"))
'    periodEnd = Trim(request.querystring("selectedValue1"))
'    brnchID = Trim(request.querystring("branID"))
'
'    periodStart = FormatDate(periodStart)
'    periodEnd = FormatDate(periodEnd)
'    brnchID = Trim(brnchID)
'Else
'    periodStart = FormatDate(Now - 1)
'    periodEnd = FormatDate(Now)
'    brnchID = "B001"
'End If

'page_title = "Admission Analysis Between " & periodStart & " And " & periodEnd & " :" & GetComboName("Branch", brnchID) & " "
Styling
MultiSelectStyles
'AddCss

response.write "<!DOCTYPE html>"
response.write "<html lang='en'>"
response.write "<head>"
response.write "<meta charset='UTF-8'>"
response.write "<meta name='viewport' content='width=device-width, initial-scale=1.0'>"
response.write "<title>Visitation  Analysis</title>"

response.write "<script src='https://cdn.plot.ly/plotly-latest.min.js'></script>"

response.write "    <link href=""https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"" rel=""stylesheet"""
response.write "        integrity=""sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM"" crossorigin=""anonymous"">"
response.write "    <script src=""https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"""
response.write "        integrity=""sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz"""
response.write "        crossorigin=""anonymous""></script>"
response.write " <link href=""https://cdn.datatables.net/v/bs5/jq-3.6.0/jszip-2.5.0/dt-1.13.5/af-2.6.0/b-2.4.0/b-colvis-2.4.0/b-html5-2.4.0/b-print-2.4.0/cr-1.7.0/date-1.5.0/fc-4.3.0/fh-3.4.0/kt-2.10.0/r-2.5.0/rg-1.4.0/rr-1.4.0/sc-2.2.0/sb-1.5.0/sp-2.2.0/sl-1.7.0/sr-1.3.0/datatables.min.css"" rel=""stylesheet""/>"
response.write " <script src=""https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js""></script>"
response.write " <script src=""https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js""></script>"
response.write " <script src=""https://cdn.datatables.net/v/bs5/jq-3.6.0/jszip-2.5.0/dt-1.13.5/af-2.6.0/b-2.4.0/b-colvis-2.4.0/b-html5-2.4.0/b-print-2.4.0/cr-1.7.0/date-1.5.0/fc-4.3.0/fh-3.4.0/kt-2.10.0/r-2.5.0/rg-1.4.0/rr-1.4.0/sc-2.2.0/sb-1.5.0/sp-2.2.0/sl-1.7.0/sr-1.3.0/datatables.min.js""></script>"

response.write "<style>"
response.write "  .chart-container {"
response.write "    display: flex;"
response.write "    justify-content: center;"
response.write "  }"
response.write "  .chart {"
response.write "    flex: 1;"
response.write "    margin: 10px;"
response.write "    width: 80%;"
response.write "  }"
response.write "  .tab-header {"
response.write "    display: flex;"
response.write "    justify-content: center;"
response.write "    background-color: #007bff;"
response.write "    border: 1px solid #ddd;"
response.write "    border-radius: 5px;"
response.write "  }"
response.write "  .tab-button {"
response.write "    flex: 1;"
response.write "    padding: 10px;"
response.write "    text-align: center;"
response.write "    cursor: pointer;"
response.write "    font-weight: bold;"
response.write "    color: #fff;"
response.write "    border-right: 1px solid #ddd;"
response.write "  }"
response.write "  .tab-button:last-child {"
response.write "    border-right: none;"
response.write "  }"
response.write "  .tab-button.active {"
response.write "    background-color: #0056b3;"
response.write "  }"
response.write "  .tab-content {"
response.write "    display: none;"
response.write "    padding: 20px;"
response.write "    border: 1px solid #ddd;"
response.write "    border-radius: 5px;"
response.write "    background-color: #f9f9f9;"
response.write "    margin-top: 10px;"
response.write "  }"
response.write "  .tab-content.active {"
response.write "    display: block;"
response.write "  }"
response.write "</style>"


response.write "</head>"
response.write "<body>"

'calling InitPageScript sub
'InitPageScript

'calling filters sub
'filters

'yearly tab starts here
  ' Construct SQL query for dropdown options (all pharmacies)
    sql = "Select WardID, Wardname from Ward"

    ' Initialize and open database connection for dropdown options
    Set rstDropdown = CreateObject("ADODB.Recordset")
    rstDropdown.open sql, conn, 3, 4

    ' Populate dropdown options
    dropdownOptions = ""

    With rstDropdown
        If .recordCount > 0 Then
            .movefirst
            Do Until .EOF
                optionHTML = "<option value='" & .fields("WardID") & "'>" & .fields("Wardname") & "</option>"
                dropdownOptions = dropdownOptions & optionHTML
                .MoveNext
            Loop
        End If
    End With

    ' Close dropdown recordset
    rstDropdown.Close
    Set rstDropdown = Nothing

' Output dropdown
    response.write "<div>"
    response.write "        <label for='ward' class='font-style'>Select Ward:</label><br>"
    response.write "        <select id='ward' name='ward' multiple class='mult-select-tag'>"
    response.write dropdownOptions
    response.write "        </select>"
    response.write "</div>"
    
    ' Output HTML Form for date selection
    response.write "    <form id='dateForm'>"
    response.write "    <div class='container' style='display: flex; align-items: center; justify-content: center'> "
    response.write "        <div> "
    response.write "            <label for='from'>From</label> "
    response.write "            <input type='date' name='from' id='from'> "
    response.write "        </div> "
    response.write "        <div> "
    response.write "            <label for='to' style='margin-left: 10px'>To</label> "
    response.write "            <input type='date' name='to' id='to'> "
    response.write "        </div> "
    response.write "        <div> "
    response.write "            <button type='button' onclick='updateUrl()'>Show Data</button> <br />"
    response.write "        </div>    "
    response.write "    </div> "
    response.write "   </form>"
    
     If (periodStart <> "" And periodEnd <> "") Then
        response.write "<h2 class='font-style'>SHOWING DATA FROM: " & periodStart & " TO: " & periodEnd & "</h2>"
    Else
        response.write "<h2 class='font-style'>SHOWING DATA FROM: 2018-01-01 TO: 2018-01-31</h2>"
    End If



response.write "<div id='yearlyTab' class='tab-content active'>"
response.write "  <div class='chart-container'>"
response.write "    <div id='yearlyChartDiv' class='chart'></div>"
response.write "  </div>"

' yearly table

  response.write "      <table style=""width:100%"" id=""yearlyTable"" class=""table table-striped table-bordered table-sm table-responsive pb-3"" width=""100%"">"
  response.write "      <thead class=""table-dark"">"
  response.write "        <tr>"
  response.write "             <th>S/No.</th>"
  response.write "             <th>Patient Name</th>"
  response.write "             <th>Visit Type</th>"
  response.write "             <th>Visit Date</th>"
  response.write "             <th>Admission Status </th>"
  response.write "             <th>Admission Date</th>"
  response.write "             <th>Discharge Date</th>"
  response.write "             <th>Ward</th>"
  response.write "             <th>Bed</th>"
  response.write "        </tr>"
  response.write "       </thead>"
  response.write "    </table>"
response.write "</div>"

'yearly tab end here

response.write "</body>"
response.write "</html>"


get_yearly_visits_analysis

Sub get_yearly_visits_analysis()
    'Dim sql, rst
    Dim sql, count
   ' Dim rstDropdown, rstMain
    Dim dropdownOptions, optionHTML
    
'    ' Retrieve query parameters
'    datePeriod = Trim(request.querystring("Dateperiod"))
'    selectedWardIDs = Trim(request.querystring("WardID"))
'
'    ' Parse date period
'    If datePeriod <> "" Then
'        dateArr = Split(datePeriod, "||")
'        periodStart = dateArr(0)
'        periodEnd = dateArr(1)
'    End If
'
'     ' Format selected drug store IDs
'    If selectedWardIDs <> "" Then
'        idsArr = Split(selectedWardIDs, ",")
'        For Each id In idsArr
'            formattedIDs = formattedIDs & "'" & Trim(id) & "',"
'        Next
'        ' Remove the trailing comma
'        formattedIDs = Left(formattedIDs, Len(formattedIDs) - 1)
'    End If
    
'     ' Construct SQL query for dropdown options (all pharmacies)
'    sql = "Select WardID, Wardname from Ward"
'
'    ' Initialize and open database connection for dropdown options
'    Set rstDropdown = CreateObject("ADODB.Recordset")
'    rstDropdown.open sql, conn, 3, 4
'
'    ' Populate dropdown options
'    dropdownOptions = ""
'
'    With rstDropdown
'        If .recordCount > 0 Then
'            .movefirst
'            Do Until .EOF
'                optionHTML = "<option value='" & .fields("WardID") & "'>" & .fields("Wardname") & "</option>"
'                dropdownOptions = dropdownOptions & optionHTML
'                .MoveNext
'            Loop
'        End If
'    End With
'
'    ' Close dropdown recordset
'    rstDropdown.Close
'    Set rstDropdown = Nothing
    
    'Set rst = CreateObject("ADODB.Recordset")
    
' Construct SQL query for main data
    sql = "select "
    sql = sql & "Patient.PatientName, "
    sql = sql & "VisitType.VisitTypeName, "
    sql = sql & "convert(varchar(20), Visitation.VisitDate, 103) VisitDate, "
    sql = sql & "AdmissionStatus.AdmissionStatusName, "
    sql = sql & "convert(varchar(20), Admission.AdmissionDate, 103) AdmissionDate, "
    sql = sql & "convert(varchar(20), Admission.DischargeDate, 103) DischargeDate, "
    sql = sql & "Ward.WardName, "
    sql = sql & "Bed.BedName "
    sql = sql & "from "
    sql = sql & "Patient "
    sql = sql & "join "
    sql = sql & "Visitation "
    sql = sql & "on Visitation.PatientID = Patient.PatientID "
    sql = sql & "join "
    sql = sql & "VisitType on Visitation.VisitTypeID = VisitType.VisitTypeID "
    sql = sql & "join "
    sql = sql & "Admission on Admission.VisitationID = Visitation.VisitationID "
    sql = sql & "join "
    sql = sql & "AdmissionStatus on AdmissionStatus.AdmissionStatusID = Admission.AdmissionStatusID "
    sql = sql & "join "
    sql = sql & "Ward on Admission.WardID = Ward.WardID "
    sql = sql & "join "
    sql = sql & "Bed on Admission.BedID = Bed.BedID "
    sql = sql & "where "
     If (periodStart <> "" And periodEnd <> "") Then
        sql = sql & "convert(date, Visitation.VisitDate) between '" & periodStart & "' and '" & periodEnd & "' "
    Else
        sql = sql & "convert(date, Visitation.VisitDate) between '2018-01-01' and '2018-04-01' "
    End If
    
    If selectedWardIDs <> "" Then
        sql = sql & "and Ward.WardID IN (" & formattedIDs & ")"
    Else
        sql = sql & "and Ward.WardID IS NOT NULL "
    End If
    
    sql = sql & "order by "
    sql = sql & "convert(date, Admission.AdmissionDate) desc"

    response.write sql
    
    ' Initialize and open database connection for main data
    Set rstMain = CreateObject("ADODB.Recordset")
    rstMain.open sql, conn, 3, 4
    'rst.open sql, conn, 3, 4
    
    
'    ' Output dropdown
'    response.write "<div>"
'    response.write "        <label for='ward' class='font-style'>Select Ward:</label><br>"
'    response.write "        <select id='ward' name='ward' multiple class='mult-select-tag'>"
'    response.write dropdownOptions
'    response.write "        </select>"
'    response.write "</div>"
'
'    ' Output HTML Form for date selection
'    response.write "    <form id='dateForm'>"
'    response.write "    <div class='container' style='display: flex; align-items: center; justify-content: center'> "
'    response.write "        <div> "
'    response.write "            <label for='from'>From</label> "
'    response.write "            <input type='date' name='from' id='from'> "
'    response.write "        </div> "
'    response.write "        <div> "
'    response.write "            <label for='to' style='margin-left: 10px'>To</label> "
'    response.write "            <input type='date' name='to' id='to'> "
'    response.write "        </div> "
'    response.write "        <div> "
'    response.write "            <button type='button' onclick='updateUrl()'>Show Data</button> <br />"
'    response.write "        </div>    "
'    response.write "    </div> "
'    response.write "   </form>"
'
'     If (periodStart <> "" And periodEnd <> "") Then
'        response.write "<h2 class='font-style'>SHOWING DATA FROM: " & periodStart & " TO: " & periodEnd & "</h2>"
'    Else
'        response.write "<h2 class='font-style'>SHOWING DATA FROM: 2018-01-01 TO: 2018-01-31</h2>"
'    End If
    
    Dim jsonData, counter
    counter = 1
    jsonData = "{""data"":["

    If rstMain.recordCount > 0 Then
        rstMain.movefirst
        Do While Not rstMain.EOF
            jsonData = jsonData & "{"
            jsonData = jsonData & """counter"":""" & counter & ""","
            jsonData = jsonData & """PatientName"":""" & rstMain.fields("PatientName").Value & ""","
            jsonData = jsonData & """VisitTypeName"":""" & rstMain.fields("VisitTypeName").Value & ""","
            jsonData = jsonData & """VisitDate"":""" & rstMain.fields("VisitDate").Value & ""","
            jsonData = jsonData & """AdmissionStatusName"":""" & rstMain.fields("AdmissionStatusName").Value & ""","
            jsonData = jsonData & """AdmissionDate"":""" & rstMain.fields("AdmissionDate").Value & ""","
            jsonData = jsonData & """DischargeDate"":""" & rstMain.fields("DischargeDate").Value & ""","
            jsonData = jsonData & """WardName"":""" & rstMain.fields("WardName").Value & ""","
            jsonData = jsonData & """BedName"":""" & rstMain.fields("BedName").Value & """"
            jsonData = jsonData & "},"
            rstMain.MoveNext
            counter = counter + 1
        Loop
        jsonData = Left(jsonData, Len(jsonData) - 1) ' Remove the trailing comma
    End If

    jsonData = jsonData & "]}"

    rstMain.Close
    Set rstMain = Nothing
    
    ' Output scripts
    response.write "<script src='https://cdn.jsdelivr.net/gh/habibmhamadi/multi-select-tag@3.0.1/dist/js/multi-select-tag.js'></script>"
    response.write "<script>"
        response.write "    new MultiSelectTag('ward', {"
        response.write "        rounded: true,"
        response.write "        shadow: true,"
        response.write "        placeholder: 'Search',"
        response.write "        tagColor: {"
        response.write "            textColor: '#327b2c',"
        response.write "            borderColor: '#92e681',"
        response.write "            bgColor: '#eaffe6',"
        response.write "        },"
        response.write "        onChange: function (values) {"
        response.write "            console.log(values);"
        response.write "        },"
        response.write "    });"
        response.write "    function updateUrl() {"
        response.write "        const fromDate = document.getElementById('from').value;"
        response.write "        const toDate = document.getElementById('to').value;"
        response.write "        const ward = Array.from(document.getElementById('ward').selectedOptions).map(option => option.value).join(',');"
        response.write "        const baseUrl = 'http://192.168.5.11/thhms15/wpgPrtPrintLayoutAll.asp';"
        response.write "        const params = new URLSearchParams({"
        response.write "            PrintLayoutName: 'dispPagination',"
        response.write "            PositionForTableName: 'WorkingDay',"
        response.write "            WorkingDayID: '',"
        response.write "            Dateperiod: `${fromDate}||${toDate}`,"
        response.write "            WardID: ward"
        response.write "        });"
        response.write "        const newUrl = baseUrl + '?' + params.toString();"
        response.write "        window.location.href = newUrl;"
        response.write "        console.log(newUrl);"
        response.write "    }"
    response.write "</script>"
    
    'response.write jsonData
' ==========================================================================================================================
'    ' Send the data to the client-side
'    response.write "<script>"
'    response.write "var dbDataYearly = " & jsonData & ";"
'    response.write "document.addEventListener('DOMContentLoaded', function() {"
'    response.write "    var revenueSourcesYearly = dbDataYearly.data;"
'
'    ' Creating a set of unique age groups
'    response.write "    var ageGroups = [...new Set(revenueSourcesYearly.map(pair => pair.AgeGroup))];"
'    response.write "    var traces = [];"
'
'    ' Defining a color palette
'    response.write "    var colors = ['#FF6347', '#4682B4', '#32CD32', '#FFD700', '#4B0082', '#FF69B4', '#8B4513', '#00CED1', '#DC143C', '#2F4F4F'];"
'    response.write "    var colorIndex = 0;"
'
'    response.write "    ageGroups.forEach(function(ageGroup) {"
'    response.write "        var filteredData = revenueSourcesYearly.filter(pair => pair.AgeGroup == ageGroup);"
'    response.write "        var trace = {"
'    response.write "            x: filteredData.map(pair => pair.Year),"
'    response.write "            y: filteredData.map(pair => parseFloat(pair.numOfVisits)),"
'    response.write "            type: 'bar',"
'    response.write "            name: ageGroup,"
'    response.write "            text: filteredData.map(pair => 'Year: ' + pair.Year + '<br>Age Group: ' + pair.AgeGroup + '<br>Number of Visits: ' + pair.numOfVisitsF + '<br>Previous Year Count: ' + pair.PrevYearCountF + '<br>Difference: ' + pair.DiffF + '<br>Percentage Change: ' + pair.PercentageChangeF + '%<br>Contribution to Age Group: ' + pair.PercentageContToAgeGroupF + '%<br>Contribution to Annual Total: ' + pair.PercentageToAnnualTotalF + '%<br>Cumulative Yearly Counts: ' + pair.CumulativeYearlyCountsF + '<br>Overall Total: ' + pair.OverallTotalF + '<br>Percentage Of Overall Total: ' + pair.PercentageToOverallTotalF  + '%'),"
'    response.write "            hovertemplate: '%{text}',"
'    response.write "            marker: {"
'    response.write "                color: colors[colorIndex % colors.length]"
'    response.write "            }"
'    response.write "        };"
'    response.write "        traces.push(trace);"
'    response.write "        colorIndex++;"
'    response.write "    });"
'
'    ' Layout for bar chart
'    response.write "    var barLayout = {"
'    response.write "        title: 'Yearly Visits Analysis By Year and Age Group',"
'    response.write "        xaxis: { title: 'Year' },"
'    response.write "        yaxis: { title: 'Number of Visits' },"
'    response.write "        legend: { orientation: 'h', y: -0.3, x: 0.5, xanchor: 'center', yanchor: 'top' },"
'    response.write "        height: 600, width: window.innerWidth * 1.0"
'    response.write "    };"
'
'    ' Plot the bar chart
'    response.write "    Plotly.newPlot('yearlyChartDiv', traces, barLayout);"
'    response.write "});"
'    response.write "</script>"

    ' DataTable Initialization
    response.write "<script>"
    response.write "var dbDataYearly = " & jsonData & ";"
    response.write "    new DataTable('#yearlyTable', {"
    response.write "        data: dbDataYearly.data,"
    response.write "        columns: ["
    response.write "            { data: 'counter' },"
    response.write "            { data: 'PatientName' },"
    response.write "            { data: 'VisitTypeName' },"
    response.write "            { data: 'VisitDate' },"
    response.write "            { data: 'AdmissionStatusName' },"
    response.write "            { data: 'AdmissionDate' },"
    response.write "            { data: 'DischargeDate' },"
    response.write "            { data: 'WardName' },"
    response.write "            { data: 'BedName' }"
    response.write "        ],"
        
    response.write "        lengthMenu: [[10, 25, 50, 100, -1], [10, 25, 50, 100, 'All']],"
    response.write "        dom: 'lBfrtip',"
    response.write "        buttons: ["
    response.write "            {"
    response.write "                extend: 'csv',"
    response.write "                text: 'CSV',"
    response.write "                title: '" & brnchName & " Yearly Visitations From: " & FormatDate(periodStart) & " To: " & FormatDate(periodEnd) & "'"
    response.write "            },"
    response.write "            {"
    response.write "                extend: 'excel',"
    response.write "                text: 'EXCEL',"
    response.write "                title: '" & brnchName & " Yearly Visitations From: " & FormatDate(periodStart) & " To: " & FormatDate(periodEnd) & "'"
    response.write "            },"
    response.write "            {"
    response.write "                extend: 'pdf',"
    response.write "                text: 'PDF',"
    response.write "                title: '" & brnchName & " Yearly Visitations From: " & FormatDate(periodStart) & " To: " & FormatDate(periodEnd) & "'"
    response.write "            },"
    response.write "            {"
    response.write "                extend: 'print',"
    response.write "                text: 'PRINT',"
    response.write "                title: '" & brnchName & " Yearly Visitations From: " & FormatDate(periodStart) & " To: " & FormatDate(periodEnd) & "'"
    response.write "            }"
    response.write "        ]"
    response.write "    });"
    response.write "</script>"
End Sub

Sub Styling()
    response.write " <style>"
        response.write " .mytable {"
        response.write "     width: 85vw;"
        response.write "     font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif; "
        response.write "     border-collapse: collapse;"
        response.write "     margin-top: 50px; "
        response.write "     border-radius: 10px;"
        response.write " }"
        
        
        response.write " .container {"
        response.write "    display: flex"
        response.write "    margin-top: 50px !important;"
        response.write "    padding-top: 30px;"
        response.write " } "
        
        response.write " .myth, .mytd {"
        response.write "     border: 1px solid #ddd;"
        response.write "     padding: 10px;"
        response.write " }"
        
        response.write " .mytd {"
        response.write "     text-alig: 1px solid #ddd;"
        response.write "     padding: 8px;"
        response.write " }"
        
        response.write "  tr:nth-child(even) {"
        response.write "    background-color: rgba(249, 249, 249, 6);"
        response.write " } "
        
        response.write " .myth {"
        response.write "     background-color: #c2c2c2;"
        response.write "     color: black;"
        response.write "     text-align: center; "
        response.write "     text-transform: uppercase; "
        response.write "     font-size: 18px;"
        response.write " }"
        
        response.write "  button {"
        response.write "     background-color: #0236c4;"
        response.write "     border-radius: 5px;"
        response.write "     border: none;"
        response.write "     margin-left: 50px;"
        response.write "     padding: 5px 20px;"
        response.write "     color: white;"
        response.write "     cursor: pointer;"
        response.write "  }"
        
        response.write "  #to, #from {"
        response.write "    padding: 5px;"
        response.write "    border-radius: 5px;"
        response.write "    cursor: pointer;"
        response.write "  }"
        
        response.write " .pagination {"
        response.write "    text-align: center;"
        response.write "    margin: 20px 0;"
        response.write " }"
        
        response.write " .pagination a {"
        response.write "    margin: 0 5px;"
        response.write "    padding: 10px 15px;"
        response.write "    background-color: #f1f1f1;"
        response.write "    border: 1px solid #ccc;"
        response.write "    text-decoration: none;"
        response.write "    color: #333;"
        response.write " }"
        
        response.write " .pagination a:hover {"
        response.write "    background-color: #ddd;"
        response.write " }"
        
        response.write " .font-style {"
        response.write "    font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;"
        response.write " }"
        
        response.write " #pharmacy {"
        response.write "    padding-bottom: 10px;"
        response.write " }"
        response.write " </style>"
        
End Sub

Sub MultiSelectStyles()
     response.write "    <style>" & vbCrLf
    response.write "        .mult-select-tag {" & vbCrLf
    response.write "            display: flex;" & vbCrLf
    response.write "            width: 300px;" & vbCrLf
    response.write "            flex-direction: column;" & vbCrLf
    response.write "            align-items: center;" & vbCrLf
    response.write "            position: relative;" & vbCrLf
    response.write "            --tw-shadow: 0 1px 3px 0 rgb(0 0 0 / 0.1), 0 1px 2px -1px rgb(0 0 0 / 0.1);" & vbCrLf
    response.write "            --tw-shadow-color: 0 1px 3px 0 var(--tw-shadow-color), 0 1px 2px -1px var(--tw-shadow-color);" & vbCrLf
    response.write "            --border-color: rgb(218, 221, 224);" & vbCrLf
    response.write "            font-family: Verdana, sans-serif;" & vbCrLf
    response.write "        }" & vbCrLf
    response.write "        .mult-select-tag .wrapper {" & vbCrLf
    response.write "            width: 100%;" & vbCrLf
    response.write "        }" & vbCrLf
    response.write "        .mult-select-tag .body {" & vbCrLf
    response.write "            display: flex;" & vbCrLf
    response.write "            border: 1px solid var(--border-color);" & vbCrLf
    response.write "            background: #fff;" & vbCrLf
    response.write "            min-height: 2.15rem;" & vbCrLf
    response.write "            width: 100%;" & vbCrLf
    response.write "            min-width: 14rem;" & vbCrLf
    response.write "        }" & vbCrLf
    response.write "        .mult-select-tag .input-container {" & vbCrLf
    response.write "            display: flex;" & vbCrLf
    response.write "            flex-wrap: wrap;" & vbCrLf
    response.write "            flex: 1 1 auto;" & vbCrLf
    response.write "            padding: 0.1rem;" & vbCrLf
    response.write "            align-items: center;" & vbCrLf
    response.write "        }" & vbCrLf
    response.write "        .mult-select-tag .input-body {" & vbCrLf
    response.write "            display: flex;" & vbCrLf
    response.write "            width: 100%;" & vbCrLf
    response.write "        }" & vbCrLf
    response.write "        .mult-select-tag .input {" & vbCrLf
    response.write "            flex: 1;" & vbCrLf
    response.write "            background: 0 0;" & vbCrLf
    response.write "            border-radius: 0.25rem;" & vbCrLf
    response.write "            padding: 0.45rem;" & vbCrLf
    response.write "            margin: 10px;" & vbCrLf
    response.write "            color: #2d3748;" & vbCrLf
    response.write "            outline: 0;" & vbCrLf
    response.write "            border: 1px solid var(--border-color);" & vbCrLf
    response.write "        }" & vbCrLf
    response.write "        .mult-select-tag .btn-container {" & vbCrLf
    response.write "            color: #e2ebf0;" & vbCrLf
    response.write "            padding: 0.5rem;" & vbCrLf
    response.write "            display: flex;" & vbCrLf
    response.write "            border-left: 1px solid var(--border-color);" & vbCrLf
    response.write "        }" & vbCrLf
    response.write "        .mult-select-tag button {" & vbCrLf
    response.write "            cursor: pointer;" & vbCrLf
    response.write "            width: 100%;" & vbCrLf
    response.write "            color: #718096;" & vbCrLf
    response.write "            outline: 0;" & vbCrLf
    response.write "            height: 100%;" & vbCrLf
    response.write "            border: none;" & vbCrLf
    response.write "            padding: 0;" & vbCrLf
    response.write "            background: 0 0;" & vbCrLf
    response.write "            background-image: none;" & vbCrLf
    response.write "            -webkit-appearance: none;" & vbCrLf
    response.write "            text-transform: none;" & vbCrLf
    response.write "            margin: 0;" & vbCrLf
    response.write "        }" & vbCrLf
    response.write "        .mult-select-tag button:first-child {" & vbCrLf
    response.write "            width: 1rem;" & vbCrLf
    response.write "            height: 90%;" & vbCrLf
    response.write "        }" & vbCrLf
    response.write "        .mult-select-tag .drawer {" & vbCrLf
    response.write "            position: absolute;" & vbCrLf
    response.write "            background: #fff;" & vbCrLf
    response.write "            max-height: 15rem;" & vbCrLf
    response.write "            z-index: 40;" & vbCrLf
    response.write "            top: 98%;" & vbCrLf
    response.write "            width: 100%;" & vbCrLf
    response.write "            overflow-y: scroll;" & vbCrLf
    response.write "            border: 1px solid var(--border-color);" & vbCrLf
    response.write "            border-radius: 0.25rem;" & vbCrLf
    response.write "        }" & vbCrLf
    response.write "        .mult-select-tag ul {" & vbCrLf
    response.write "            list-style-type: none;" & vbCrLf
    response.write "            padding: 0.5rem;" & vbCrLf
    response.write "            margin: 0;" & vbCrLf
    response.write "        }" & vbCrLf
    response.write "        .mult-select-tag ul li {" & vbCrLf
    response.write "            padding: 0.5rem;" & vbCrLf
    response.write "            border-radius: 0.25rem;" & vbCrLf
    response.write "            cursor: pointer;" & vbCrLf
    response.write "        }" & vbCrLf
    response.write "        .mult-select-tag ul li:hover {" & vbCrLf
    response.write "            background: rgb(243 244 246);" & vbCrLf
    response.write "        }" & vbCrLf
    response.write "        .mult-select-tag .item-container {" & vbCrLf
    response.write "            display: flex;" & vbCrLf
    response.write "            justify-content: center;" & vbCrLf
    response.write "            align-items: center;" & vbCrLf
    response.write "            padding: 0.2rem 0.4rem;" & vbCrLf
    response.write "            margin: 0.2rem;" & vbCrLf
    response.write "            font-weight: 500;" & vbCrLf
    response.write "            border: 1px solid;" & vbCrLf
    response.write "            border-radius: 9999px;" & vbCrLf
    response.write "        }" & vbCrLf
    response.write "        .mult-select-tag .item-label {" & vbCrLf
    response.write "            max-width: 100%;" & vbCrLf
    response.write "            line-height: 1;" & vbCrLf
    response.write "            font-size: 0.75rem;" & vbCrLf
    response.write "            font-weight: 400;" & vbCrLf
    response.write "            flex: 0 1 auto;" & vbCrLf
    response.write "        }" & vbCrLf
    response.write "        .mult-select-tag .item-close-container {" & vbCrLf
    response.write "            display: flex;" & vbCrLf
    response.write "            flex: 1 1 auto;" & vbCrLf
    response.write "            flex-direction: row-reverse;" & vbCrLf
    response.write "        }" & vbCrLf
    response.write "        .mult-select-tag .item-close-svg {" & vbCrLf
    response.write "            width: 1rem;" & vbCrLf
    response.write "            margin-left: 0.5rem;" & vbCrLf
    response.write "            height: 1rem;" & vbCrLf
    response.write "            cursor: pointer;" & vbCrLf
    response.write "            border-radius: 9999px;" & vbCrLf
    response.write "            display: block;" & vbCrLf
    response.write "        }" & vbCrLf
    response.write "        .hidden {" & vbCrLf
    response.write "            display: none;" & vbCrLf
    response.write "        }" & vbCrLf
    response.write "        .mult-select-tag .shadow {" & vbCrLf
    response.write "            box-shadow: var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow);" & vbCrLf
    response.write "        }" & vbCrLf
    response.write "        .mult-select-tag .rounded {" & vbCrLf
    response.write "            border-radius: 0.375rem;" & vbCrLf
    response.write "        }" & vbCrLf
    response.write "    </style>" & vbCrLf
End Sub

Sub InitPageScript()
  Dim htStr
  'Client Script
  htStr = ""
  htStr = htStr & "<script id=""scptPrintLayoutExtraScript"" LANGUAGE=""javascript"">" & vbCrLf
  htStr = htStr & vbCrLf
  'RefreshPage()
  htStr = htStr & "function RefreshPage(){" & vbCrLf
  htStr = htStr & "window.location.reload();" & vbCrLf
  htStr = htStr & "}" & vbCrLf


    htStr = htStr & "                    function getQueryParam(param) { "
    htStr = htStr & "                        let urlParams = new URLSearchParams(window.location.search); "
    htStr = htStr & "                        return urlParams.get(param); "
    htStr = htStr & "                    } "

   htStr = htStr & "          function formatDate(dateString) { "
  htStr = htStr & "                   dateString = String(dateString).trim(); "
   htStr = htStr & "                  var date = new Date(dateString); "
  htStr = htStr & "                   if (isNaN(date)) { "
  htStr = htStr & "                       console.error('Invalid date string'); "
   htStr = htStr & "                      return null; "
   htStr = htStr & "                  } "
   htStr = htStr & "                 var year = date.getFullYear(); "
    htStr = htStr & "                var month = String(date.getMonth() + 1).padStart(2, '0'); "
    htStr = htStr & "                var day = String(date.getDate()).padStart(2, '0'); "

   htStr = htStr & "                 return `${year}-${month}-${day}`; "
   htStr = htStr & "             } "

  htStr = htStr & "  document.addEventListener('DOMContentLoaded', (event) => { "

  htStr = htStr & "   var dropdown = document.getElementById('Branchs'); "
     htStr = htStr & "                 var defaultBranch = getQueryParam('branID'); "

htStr = htStr & "             for (var i = 0; i < dropdown.options.length; i++) { "
  htStr = htStr & "               if (dropdown.options[i].value === defaultBranch) { "
  htStr = htStr & "                   dropdown.selectedIndex = i; "
    htStr = htStr & "                 break; "
    htStr = htStr & "             } "
    htStr = htStr & "         } "
   htStr = htStr & "                 var selectedValue = getQueryParam('selectedValue'); "
   htStr = htStr & "                     if (selectedValue === null) {   "
    htStr = htStr & "          var startDateInput = document.getElementById('startDate'); "
    htStr = htStr & "          var today = new Date(); "
    htStr = htStr & "          var day = ('0' + today.getDate()).slice(-2); "
    htStr = htStr & "          var month = ('0' + (today.getMonth() + 1)).slice(-2); "
    htStr = htStr & "          var todayString = today.getFullYear() + '-' + month + '-' + day; "
    htStr = htStr & "          startDateInput.value = todayString; "
   htStr = htStr & "                     } else { "
   htStr = htStr & "                         var formattedDate = formatDate(selectedValue); "
   htStr = htStr & "                         if (formattedDate) { "
   htStr = htStr & "                         console.log('Formatted Date: ' + formattedDate); "
   htStr = htStr & "                          } else { "
   htStr = htStr & "                                    console.error('Invalid date string'); "
   htStr = htStr & "                        } "

      htStr = htStr & "          var startDateInput = document.getElementById('startDate'); "
           htStr = htStr & "          startDateInput.value = formattedDate; "
   htStr = htStr & "                     } "
   htStr = htStr & "                 var selectedValue1 = getQueryParam('selectedValue1'); "
   htStr = htStr & "                     if (selectedValue1 === null) { "
    htStr = htStr & "          var endDateInput = document.getElementById('endDate'); "
    htStr = htStr & "          var today = new Date(); "
    htStr = htStr & "          var day = ('0' + today.getDate()).slice(-2); "
    htStr = htStr & "          var month = ('0' + (today.getMonth() + 1)).slice(-2); "
    htStr = htStr & "          var todayString = today.getFullYear() + '-' + month + '-' + day; "
    htStr = htStr & "          endDateInput.value = todayString; "
   htStr = htStr & "                     } else { "
   htStr = htStr & "                         var formattedDate = formatDate(selectedValue1); "
   htStr = htStr & "                         if (formattedDate) { "
   htStr = htStr & "                         console.log('Formatted Date: ' + formattedDate); "
   htStr = htStr & "                          } else { "
   htStr = htStr & "                                    console.error('Invalid date string'); "
   htStr = htStr & "                        } "

      htStr = htStr & "          var endDateInput = document.getElementById('endDate'); "
           htStr = htStr & "          endDateInput.value = formattedDate; "
   htStr = htStr & "                     } "

  htStr = htStr & "      }); "

htStr = htStr & "var branchID1" & vbCrLf
htStr = htStr & "function MonthOnchange(){" & vbCrLf
htStr = htStr & "var ur, mth, sp, ordByTyp, ms, emr, str;" & vbCrLf
htStr = htStr & "mth =  document.getElementById('NoOfDays').value;" & vbCrLf
htStr = htStr & "dayid = 0;" & vbCrLf
htStr = htStr & "ur = 'wpgPrtPrintLayoutAll.asp?PrintLayoutName=visitFrequencyAnalysis&PositionForTableName=WorkingDay';" & vbCrLf
htStr = htStr & "ur = ur + '&WorkingDayID=DAY20160401&month=' + mth  + ' &yearid=' + dayid ;" & vbCrLf
htStr = htStr & "window.location.href = processurl(ur);" & vbCrLf
htStr = htStr & "}" & vbCrLf
'emrMonth
htStr = htStr & "function BranchOnchange(){" & vbCrLf
htStr = htStr & "var ur, sp, ordByTyp, ms, emr, str;" & vbCrLf
htStr = htStr & "branchID1 =  document.getElementById('Branchs').value;" & vbCrLf
htStr = htStr & "dayid = 0;" & vbCrLf

htStr = htStr & "}" & vbCrLf

'emrDay
htStr = htStr & "function YearOnchange(){" & vbCrLf
htStr = htStr & "var ur, mth, sp, ordByTyp, ms, emr, str;" & vbCrLf
htStr = htStr & "dayid = GetEleVal('NoOfDay');" & vbCrLf
htStr = htStr & "mth = 0;" & vbCrLf
htStr = htStr & "emr=GetEleVal('emrdata');" & vbCrLf
htStr = htStr & "ispr= 0;" & vbCrLf
htStr = htStr & "ur = 'wpgPrtPrintLayoutAll.asp?PrintLayoutName=VisitFrequencyAnalysis&PositionForTableName=WorkingDay';" & vbCrLf
htStr = htStr & "ur = ur + '&WorkingDayID=DAY20160401&month=' + mth  + ' &yearid=' + dayid ;" & vbCrLf
htStr = htStr & "window.location.href = processurl(ur);" & vbCrLf
htStr = htStr & "}" & vbCrLf


  htStr = htStr & "function PeriodOnclick(){ " & vbCrLf
  htStr = htStr & "var branchID1 =  document.getElementById('Branchs').value;" & vbCrLf
  htStr = htStr & "var startDate1 =  document.getElementById('startDate').value;" & vbCrLf
  htStr = htStr & "var endDate1 =  document.getElementById('endDate').value;" & vbCrLf
  htStr = htStr & "startDate1 = startDate1.trimEnd();" & vbCrLf
  htStr = htStr & "endDate1 = endDate1.trimEnd();" & vbCrLf

  htStr = htStr & "ur = 'wpgPrtPrintLayoutAll.asp?PrintLayoutName=visitFrequencyAnalysis&PositionForTableName=WorkingDay';" & vbCrLf
  htStr = htStr & "ur = ur + '&WorkingDayID=DAY20160401&selectedValue=' + startDate1  + ' &selectedValue1=' + endDate1 + ' &branID=' + branchID1 ;" & vbCrLf


    htStr = htStr & "    window.location = ur;" & vbCrLf

  htStr = htStr & "}" & vbCrLf

  'emrdata
  htStr = htStr & "function OpenDiseaseFilterOnclick(){ " & vbCrLf
  htStr = htStr & "var branchID1 =  document.getElementById('Branchs').value;" & vbCrLf
  htStr = htStr & "var startDate1 =  document.getElementById('startDate').value;" & vbCrLf
  htStr = htStr & "var endDate1 =  document.getElementById('endDate').value;" & vbCrLf
  htStr = htStr & "startDate1 = startDate1.trimEnd();" & vbCrLf
  htStr = htStr & "endDate1 = endDate1.trimEnd();" & vbCrLf
'   htStr = htStr & "var branchID =  'B001';" & vbCrLf
  htStr = htStr & "ur = 'wpgPrtPrintLayoutAll.asp?PrintLayoutName=visitFrequencyAnalysis&PositionForTableName=WorkingDay';" & vbCrLf
  htStr = htStr & "ur = ur + '&WorkingDayID=DAY20160401&selectedValue=' + startDate1  + ' &selectedValue1=' + endDate1 + ' &branID=' + branchID1 ;" & vbCrLf
  htStr = htStr & "    window.location.href = processurl(ur);" & vbCrLf
'   htStr = htStr & "alert('This Functionality is under Maintenance');" & vbCrf
  htStr = htStr & "}" & vbCrLf
  
   
  
  
  'copy receipt number
    htStr = htStr & "function copyTextToClipboard(icon) {" & vbCrLf
    htStr = htStr & "const textToCopy = icon.parentElement.innerText.trim();" & vbCrLf
    htStr = htStr & "const textField = document.createElement('textarea');" & vbCrLf
    htStr = htStr & "textField.value = textToCopy;" & vbCrLf
    htStr = htStr & "document.body.appendChild(textField);" & vbCrLf
    htStr = htStr & "textField.select();" & vbCrLf
    htStr = htStr & "document.execCommand('copy');" & vbCrLf
    htStr = htStr & "document.body.removeChild(textField);" & vbCrLf
    htStr = htStr & "alert('Text copied to clipboard!');" & vbCrLf
    htStr = htStr & "};" & vbCrLf
'    htStr = htStr & " setTimeout(location.reload(),3000); " & vbCrLf
'    htStr = htStr & " console.log('wossop'); " & vbCrLf
    htStr = htStr & "</script>" & vbCrLf
  
  htStr = htStr & "</script>"
  response.write htStr
  js = js & "<script>" & vbCrLf
  js = js & "  " & vbCrLf
  js = js & "  " & vbCrLf
  js = js & "</script>"
  response.write js
End Sub


Sub filters()
'table for filters
    response.write "<table class = 'table table-bordered'>"
    response.write "        <tr '>"
    response.write "           <td> Facility: </td>   "
    response.write "            <td> "
    SetBranch
    response.write " </td>"

    response.write "           <td>From :</td>   "
    response.write "            <td><input type = 'date' id ='startDate'/>   </td>"
    response.write "           <td> To : </td>   "
    response.write "           <td> <input type = 'date'  id ='endDate'/> </td>    "
    response.write "           <td> <button  class='btn' style='background-color: #007bff; color: #fff' onclick=""PeriodOnclick()"" >Process</button> </td>   "
    
    response.write "    </table>"

End Sub

Sub SetBranch()
        Set rst = CreateObject("ADODB.Recordset")
        dyHt = "<select class='form-select' size=""1"" name=""Branchs"" id=""Branchs"" onchange=""BranchOnchange()"">"
        dyHt = dyHt & "<option value=""""></option>"
        ' dyHt = dyHt & "<option value='B001'></option>"

      
        sql0 = "select BranchID, BranchName from Branch b "
        With rst
          .open qryPro.FltQry(sql0), conn, 3, 4
          If .recordCount > 0 Then
            .movefirst
            Do While Not .EOF
              branchIDD = Trim(.fields("BranchID"))
              branchName11 = Trim(.fields("BranchName"))

              If UCase(CStr(yearId)) = UCase(branchIDD) Then
                dyHt = dyHt & "<option value=""" & CStr(branchIDD) & """ selected>" & branchName11 & "</option>"
              Else
                 dyHt = dyHt & "<option value=""" & CStr(branchIDD) & """>" & branchName11 & "</option>"
              End If
               rst.MoveNext
                response.flush
            Loop
          End If
          .Close
        End With
        dyHt = dyHt & "</select>"
        response.write dyHt
         Set rst = Nothing
End Sub


Function FormatDate(dateValue)
    FormatDate = Year(dateValue) & "-" & Right("0" & Month(dateValue), 2) & "-" & Right("0" & day(dateValue), 2)
End Function

Function FormatDateNew(dateString)
    Dim dateParts, yearPart, monthPart, dayPart, formatedDate
    dateParts = Split(dateString, "-")
    yearPart = dateParts(0)
    monthPart = dateParts(1)
    dayPart = dateParts(2)
    formatedDate = dayPart & "/" & monthPart & "/" & yearPart
    FormatDateNew = formatedDate
End Function

Function GetComboName(table, id)
    GetComboName = "Branch Name"
End Function

Sub AddCss()

response.write "<style>"

response.write "/* ==== Data table  = Start ===== */"
response.write ""
response.write ".data_table{"
response.write "   background: #fff;"
response.write "    padding: 15px;"
response.write "    box-shadow: 1px 3px 5px #aaa;"
response.write "    border-radius: 5px;"
response.write "}"
response.write ""
response.write ".data_table .btn{"
response.write "    padding: 5px 10px;"
response.write "    margin: 10px 3px 10px 0;"
response.write "}"


response.write "    #previous, #next {"
response.write "        float: right;"
response.write "    }"

response.write "        #filterButton, #resetButton, #previous, #next {"
response.write "            border-radius: 5px; "
response.write "            background-color: #007bff; "
response.write "            color: #ffffff; "
response.write "            padding: 8px 12px; "
response.write "            margin-right: 10px; "
response.write "            border: none;"
response.write "            cursor: pointer;"
response.write "        }"
response.write "        #filterButton:hover, #resetButton:hover, #previous:hover, #next:hover {"
response.write "            background-color: #0056b3;"
response.write "        }"

response.write ".styled-input {"
response.write "    border: 1px solid #ccc;"
response.write "    border-radius: 8px;"
response.write "    padding: 8px;"
response.write "    margin-right: 10px;"
response.write "    font-size: 14px;"
response.write "    outline: none;"
response.write "}"
response.write ""
response.write ".styled-button {"
response.write "    background-color: #007bff;"
response.write "    color: white;"
response.write "    border: none;"
response.write "    border-radius: 8px;"
response.write "    padding: 8px 16px;"
response.write "    cursor: pointer;"
response.write "    font-size: 14px;"
response.write "}"
response.write ""
response.write ".styled-button:hover {"
response.write "    background-color: #0056b3;"
response.write "}"


response.write "</style>"


End Sub

'<<--END_CODE_SEGMENT_PRINTHEADER-->>
'>
'>
'>
'>
'>
'<<--BEGIN_CODE_SEGMENT_PRINTFOOTER-->>

'<<--END_CODE_SEGMENT_PRINTFOOTER-->>
